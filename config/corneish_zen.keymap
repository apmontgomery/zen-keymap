/*
*
* Copyright (c) 2023 Alex Montgomery
* SPDX-License-Identifier: MIT
*
*/

#include <behaviors.dtsi>
#include <dt-bindings/zmk/keys.h>
#include <dt-bindings/zmk/bt.h>
#include <dt-bindings/zmk/mouse.h>

// Layer aliases
#define QWERTY  0
#define NAV     1
#define MEDIABT 2
#define SYMBOL  3
#define NUMBER  4
#define MOUSE   5

// window manager shortcuts
#define WTOPLEFT  LC(LA(U))
#define WTOP      LC(LA(UP))
#define WTOPRIGHT LC(LA(I))
#define WLEFT     LC(LA(LEFT))
#define WCENTER   LC(LA(ENTER))
#define WRIGHT    LC(LA(RIGHT))
#define WBTMLEFT  LC(LA(J))
#define WBOTTOM   LC(LA(DOWN))
#define WBTMRIGHT LC(LA(K))
#define WNEXTSCRN RC(RA(RG(RIGHT)))
#define WPREVSCRN RC(RA(RG(LEFT)))

// tab navigation shotrcuts
#define TAB_RT   LC(TAB)
#define TAB_LT   LC(LS(TAB))
#define FILEMENU LC(F2)
#define DOCK     LC(F3)

// media navigation shortcuts
#define FWD     LG(LS(RIGHT_ARROW)) 
#define RWD     LG(LS(LEFT_ARROW))

/ {
  chosen {
    zmk,matrix_transform = &default_transform;
    //zmk,matrix_transform = &five_column_transform;
  };
};

&mmv {
    time-to-max-speed-ms = <1000>;
    acceleration-exponent=<1>;
};

&mwh {
    time-to-max-speed-ms = <500>;
    acceleration-exponent=<1>;
};

/ {
        behaviors {
                ms: mod_sticky_key {
                compatible = "zmk,behavior-hold-tap";
                label = "MOD_STICKY_KEY";
                #binding-cells = <2>;
                flavor = "hold-preferred";
                tapping-term-ms = <200>;
                bindings = <&kp>, <&sk>;
                };
                ctrlAlt: tap_dance_0 {
                compatible = "zmk,behavior-tap-dance";
                label = "TAP_DANCE_0";
                #binding-cells = <0>;
                tapping-term-ms = <200>;
                bindings = <&ms LS(LC(LALT)) RALT>, <&sk RCTL>, <&sk RC(RALT)>;
                };
                shiftCap: tap_dance_1 {
                compatible = "zmk,behavior-tap-dance";
                label = "TAP_DANCE_1";
                #binding-cells = <0>;
                tapping-term-ms = <200>;
                bindings = <&sk LSHIFT>, <&kp CAPSLOCK>;
                }; 
                qweNavMda: tap_dance_2 {
                compatible = "zmk,behavior-tap-dance";
                label = "TAP_DANCE_2";
                #binding-cells = <0>;
                tapping-term-ms = <400>;
                bindings = <&to QWERTY>, <&to NAV>, <&to MEDIABT>;
                };
                symNumMse: tap_dance_3 {
                compatible = "zmk,behavior-tap-dance";
                label = "TAP_DANCE_3";
                #binding-cells = <0>;
                tapping-term-ms = <200>;
                bindings = <&to SYMBOL>, <&to NUMBER>, <&to MOUSE>;
                };
                mediaCtrl: media_hold_tap {
                compatible = "zmk,behavior-hold-tap";
                label = "MEDIA_HOLD_TAP";
                #binding-cells = <2>;
                flavor = "tap-preferred";
                tapping-term-ms = <200>;
                bindings = <&kp>, <&kp>;
                };
        };

        keymap {
                compatible = "zmk,keymap";

// ╭─ QWERTY ────────────────────╮   ╭─────────────────────────────╮
// ⎟  Q  ⎟  W  ⎟  E  ⎟  R  ⎟  T  ⎟   ⎟  Y  ⎟  U  ⎟  I  ⎟  O  ⎟  P  ⎟
// ⎟  A  ⎟  S  ⎟  D  ⎟  F  ⎟  G  ⎟   ⎟  H  ⎟  J  ⎟  K  ⎟  L  ⎟  ;  ⎟
// ⎟  Z  ⎟  X  ⎟  C  ⎟  V  ⎟  B  ⎟   ⎟  N  ⎟  M  ⎟  ,  ⎟  .  ⎟  /  ⎟
// ╰───────────⎟  ⧉  ⎟  ⌘  ⎟  ␣  ⎟   ⎟  ⇧  ⎟ ⌃⎇ ⎟  ⧉  ⎟───────────╯
//             ╰─────────────────╯   ╰─────────────────╯
// ╭─ ADJUST ────────────────────╮   ╭─────────────────────────────╮
// ⎟ ESC ⎟  ↖  ⎟  ↑  ⎟  ↗  ⎟  ⍐  ⎟   ⎟file ⎟ tab←⎟ tab→⎟dock ⎟  ⌫  ⎟
// ⎟  ⇥  ⎟  ←  ⎟  ▣  ⎟  →  ⎟  ⍗  ⎟   ⎟  ◄  ⎟  ▼  ⎟  ▲  ⎟  ►  ⎟  ⮐ ⎟
// ⎟  ~  ⎟  ↙  ⎟  ↓  ⎟  ↘  ⎟  ⊞  ⎟   ⎟     ⎟     ⎟     ⎟     ⎟     ⎟
// ╰───────────⎟  ⧉  ⎟  ⌘  ⎟  ␣  ⎟   ⎟  ⇧  ⎟ ⌃⎇ ⎟  ⧉  ⎟───────────╯
//             ╰─────────────────╯   ╰─────────────────╯
// ╭─ MEDIA/BT ──────────────────╮   ╭─────────────────────────────╮
// ⎟ ESC ⎟ mute⎟ vol-⎟ vol+ ⎟    ⎟   ⎟ clr⦖⎟  ⦖1 ⎟  ⦖2 ⎟ ⦖3 ⎟  ⌫  ⎟
// ⎟  ⇥  ⎟  ◄◄ ⎟  ►  ⎟  ►►  ⎟  ▣ ⎟   ⎟     ⎟  ⦖4 ⎟  ⦖5 ⎟    ⎟  ⮐  ⎟
// ⎟  ~  ⎟     ⎟  ☼- ⎟  ☼+  ⎟    ⎟   ⎟     ⎟     ⎟     ⎟     ⎟     ⎟
// ╰───────────⎟  ⧉  ⎟  ⌘  ⎟  ␣  ⎟   ⎟  ⇧  ⎟ ⌃⎇ ⎟  ⧉  ⎟───────────╯
//             ╰─────────────────╯   ╰─────────────────╯
// ╭─ SYMBOL ────────────────────╮   ╭─────────────────────────────╮
// ⎟ ESC ⎟  @  ⎟  #  ⎟  $  ⎟  %  ⎟   ⎟  ^  ⎟  &  ⎟  *  ⎟  ~  ⎟  ⌫  ⎟
// ⎟  ⇥  ⎟  =  ⎟  ’  ⎟  ’  ⎟  '  ⎟   ⎟  \  ⎟  {  ⎟  }  ⎟  ⎟  ⎟ ⮐  ⎟
// ⎟  ~  ⎟  £  ⎟  ”  ⎟  ”  ⎟  "  ⎟   ⎟  [  ⎟  (  ⎟  )  ⎟  ]  ⎟     ⎟
// ╰───────────⎟  ⧉  ⎟  ⌘  ⎟  ␣  ⎟   ⎟  ⇧  ⎟ ⌃⎇ ⎟  ⧉  ⎟───────────╯
//             ╰─────────────────╯   ╰─────────────────╯
// ╭─ NUMBER ────────────────────╮   ╭─────────────────────────────╮
// ⎟ ESC ⎟     ⎟   +  ⎟  -  ⎟  > ⎟   ⎟  _  ⎟  7  ⎟  8  ⎟  9  ⎟  ⌫  ⎟
// ⎟   ⇥ ⎟     ⎟   *  ⎟  /  ⎟  < ⎟   ⎟  =  ⎟  4  ⎟  5  ⎟  6  ⎟  ⮐ ⎟
// ⎟   ~ ⎟     ⎟   %  ⎟  ^  ⎟  . ⎟   ⎟  0  ⎟  1  ⎟  2  ⎟  3  ⎟     ⎟
// ╰───────────⎟  ⧉  ⎟  ⌘  ⎟  ␣  ⎟   ⎟  ⇧  ⎟ ⌃⎇ ⎟  ⧉  ⎟───────────╯
//             ╰─────────────────╯   ╰─────────────────╯
// ╭─ MOUSE ─────────────────────╮   ╭─────────────────────────────╮
// ⎟ ESC ⎟     ⎟     ⎟     ⎟     ⎟   ⎟scrl◄⎟scrl▼⎟scrl▲⎟scrl►⎟  ⌫  ⎟
// ⎟  ⇥  ⎟     ⎟     ⎟     ⎟     ⎟   ⎟  ◄  ⎟  ▼  ⎟  ▲  ⎟  ►  ⎟ ⮐  ⎟
// ⎟  ~  ⎟     ⎟     ⎟     ⎟     ⎟   ⎟mse ◄⎟mse ▼⎟mse ▲⎟mse ►⎟     ⎟
// ╰───────────⎟  ⧉  ⎟  ⌘  ⎟  ␣  ⎟   ⎟ 🖱️1 ⎟ 🖱️2 ⎟  ⧉ ⎟───────────╯
//             ╰─────────────────╯   ╰─────────────────╯

                default_layer {
                        label = "QWERTY";
                        bindings = <
// ╭───────┬───────┬───────┬───────┬───────┬───────╮   ╭───────┬───────┬──────────┬───────┬───────┬───────╮
     &none   &kp Q   &kp W   &kp E   &kp R   &kp T       &kp Y   &kp U   &kp I     &kp O   &kp P   &none
// ├───────┼───────┼───────┼───────┼───────┼───────┤   ├───────┼───────┼──────────┼───────┼───────┼───────┤
     &none   &kp A   &kp S   &kp D   &kp F   &kp G       &kp H   &kp J   &kp K     &kp L   &kp SEMI &none
// ├───────┼───────┼───────┼───────┼───────┼───────┤   ├───────┼───────┼──────────┼───────┼───────┼───────┤
     &none   &kp Z   &kp X   &kp C   &kp V   &kp B       &kp N   &kp M   &kp COMMA &kp DOT &kp FSLH &none
// ╰───────┴───────┴───────┼───────┼───────┼───────┤   ├───────┼───────┼──────────┴───────┴───────┴───────╯
                       &qweNavMda &kp RGUI &kp SPACE   &shiftCap &ctrlAlt &symNumMse
//                     ╰─────────┴────────┴────────╯   ╰────────┴────────┴──────────╯
                        >;
                };

                nav_layer {
                        label = "NAV";
                        bindings = <
// ╭────────┬──────────┬──────────────┬───────────┬─────────────┬────────────╮   ╭───────────┬───────────┬───────────┬────────┬─────────┬─────────╮
     &none   &kp ESC     &kp WTOPLEFT  &kp WTOP    &kp WTOPRIGHT &kp WNEXTSCRN    &kp FILEMENU &kp TAB_LT &kp TAB_RT  &kp DOCK  &kp BSPC   &none
// ├────────┼──────────┼──────────────┼───────────┼─────────────┼────────────┤   ├───────────┼───────────┼───────────┼────────┼─────────┼─────────┤
     &none   &kp TAB     &kp WLEFT     &kp WCENTER &kp WRIGHT    &kp WPREVSCRN    &kp LEFT    &kp DOWN    &kp UP      &kp RIGHT &kp ENTER  &none
// ├────────┼──────────┼──────────────┼───────────┼─────────────┼────────────┤   ├───────────┼───────────┼───────────┼────────┼─────────┼─────────┤
     &none   &kp TILDE   &kp WBTMLEFT  &kp WBOTTOM &kp WBTMRIGHT &none            &none       &none       &none       &none     &none      &none
// ╰────────┴──────────┴──────────────┼───────────┼─────────────┼────────────┤   ├───────────┼───────────┼───────────┴────────┴─────────┴─────────╯
                                                 &qweNavMda &kp RGUI &kp SPACE   &shiftCap &ctrlAlt &symNumMse
//                                               ╰─────────┴────────┴────────╯   ╰────────┴────────┴──────────╯
                        >;
                };

                media_layer {
                        label = "MEDIA/BT";
                        bindings = <
// ╭───────┬────────┬─────────────────────┬────────────────┬─────────────────────┬────────────╮   ╭──────────┬────────────┬────────────┬────────────┬──────────┬──────╮
     &none  &kp ESC  &kp K_MUTE            &kp C_VOL_DN     &kp C_VOL_UP          &trans           &bt BT_CLR &bt BT_SEL 0 &bt BT_SEL 1 &bt BT_SEL 2 &kp DELETE &none
// ├───────┼────────┼─────────────────────┼────────────────┼─────────────────────┼────────────┤   ├──────────┼────────────┼────────────┼────────────┼──────────┼──────┤
     &none  &kp TAB  &mediaCtrl RWD C_PREV &kp C_PLAY_PAUSE &mediaCtrl FWD C_NEXT &kp LG(F)        &none      &bt BT_SEL 3 &bt BT_SEL 4 &none        &kp ENTER  &none
// ├───────┼────────┼─────────────────────┼────────────────┼─────────────────────┼────────────┤   ├──────────┼────────────┼────────────┼────────────┼──────────┼──────┤
     &none  &trans    &trans               &kp C_BRI_UP     &kp C_BRI_DN          &trans           &none      &none        &none        &none        &none      &none
// ╰───────┴────────┴─────────────────────┼────────────────┼─────────────────────┼────────────┤   ├──────────┼────────────┼────────────┴────────────┴──────────┴──────╯
                                                                 &qweNavMda &kp RGUI &kp SPACE    &shiftCap &ctrlAlt &symNumMse
//                                                                ╰─────────┴────────┴────────╯   ╰─────────┴─────────┴──────────╯
                        >;
                };

                sym_layer {
                        label = "SYMBOL";
                        bindings = <
// ╭─────────┬─────────┬────────────┬────────────┬───────────────┬─────────────────╮   ╭────────────┬────────────┬──────────────┬────────────┬────────────┬───────────╮
     &none    &kp ESC   &kp AT       &kp HASH    &kp DLLR         &kp PRCNT             &kp CARET    &kp AMPS    &kp KP_MULTIPLY  &kp EXCL     &kp BSPC     &none
// ├─────────┼─────────┼────────────┼────────────┼───────────────┼─────────────────┤   ├────────────┼────────────┼──────────────┼────────────┼────────────┼───────────┤
     &none    &kp TAB   &kp EQUAL   &kp LA(RBRC) &kp LS(LA(RBRC)) &kp SINGLE_QUOTE      &kp BSLH     &kp LBRC     &kp RBRC        &kp PIPE     &kp ENTER    &none
// ├─────────┼─────────┼────────────┼────────────┼───────────────┼─────────────────┤   ├────────────┼────────────┼──────────────┼────────────┼────────────┼───────────┤
     &none    &kp TILDE &kp LA(N3)  &kp LA(LBRC) &kp LS(LA(LBRC)) &kp DOUBLE_QUOTES     &kp LBKT     &kp LPAR     &kp RPAR        &kp RBKT     &none        &none
// ╰─────────┴─────────┴────────────┼────────────┼───────────────┼─────────────────┤   ├────────────┼────────────┼──────────────┴────────────┴────────────┴───────────╯
                                                             &qweNavMda &kp RGUI &kp SPACE   &shiftCap &ctrlAlt &symNumMse
//                                                           ╰─────────┴────────┴────────╯   ╰────────┴────────┴──────────╯
                        >;
                };

                num_layer {
                        label = "NUMBER";
                        bindings = <
// ╭─────────┬─────────────┬──────────┬─────────────┬───────────────┬──────────────╮   ╭──────────────┬────────────┬────────────┬────────────┬────────────┬───────────╮
     &none    &kp ESC       &none      &kp PLUS       &kp MINUS      &kp GREATER_THAN   &kp UNDERSCORE &kp N7       &kp N8       &kp N9       &kp BSPC     &none
// ├─────────┼─────────────┼──────────┼─────────────┼───────────────┼──────────────┤   ├──────────────┼────────────┼────────────┼────────────┼────────────┼───────────┤
     &none    &kp TAB       &none      &kp KP_MULTIPLY &kp KP_DIVIDE &kp LESS_THAN      &kp EQUAL      &kp N4       &kp N5       &kp N6       &kp ENTER    &none
// ├─────────┼─────────────┼──────────┼─────────────┼───────────────┼──────────────┤   ├──────────────┼────────────┼────────────┼────────────┼────────────┼───────────┤
     &none    &kp LEFT_SHIFT &none     &kp PERCENT    &kp CARET      &kp DOT            &kp N0         &kp N1       &kp N2       &kp N3       &none       &none
// ╰─────────┴─────────────┴──────────┼─────────────┼───────────────┼──────────────┤   ├──────────────┼────────────┼────────────┴────────────┴────────────┴───────────╯
                                                             &qweNavMda &kp RGUI &kp SPACE   &shiftCap &ctrlAlt &symNumMse
//                                                           ╰─────────┴────────┴────────╯   ╰────────┴────────┴──────────╯
                        >;
                };

                mouse_layer {
                        label = "MOUSE";
                        bindings = <
// ╭───────┬────────┬───────┬──────┬──────┬───────╮   ╭─────────────────┬───────────────┬───────────────┬───────────────┬──────────────┬──────╮
     &none  &kp ESC   &none  &none  &none  &none       &mwh SCROLL_RIGHT &mwh SCROLL_UP &mwh SCROLL_DOWN &mwh SCROLL_LEFT &kp BACKSPACE &none
// ├───────┼────────┼───────┼──────┼──────┼───────┤   ├─────────────────┼───────────────┼───────────────┼───────────────┼──────────────┼──────┤
     &none  &kp TAB   &none  &none  &none  &none       &kp LEFT          &kp DOWN        &kp UP          &kp RIGHT        &kp ENTER     &none
// ├───────┼────────┼───────┼──────┼──────┼───────┤   ├─────────────────┼───────────────┼───────────────┼───────────────┼──────────────┼──────┤
     &none  &kp TILDE &none  &none  &none  &none       &mmv MOVE_LEFT    &mmv MOVE_DOWN  &mmv MOVE_UP    &mmv MOVE_RIGHT  &none         &none
// ╰───────┴────────┴───────┼──────┼──────┼───────┤   ├─────────────────┼───────────────┼───────────────┴───────────────┴──────────────┴──────╯
                       &qweNavMda &kp RGUI &kp SPACE   &mkp LCLK &mkp RCLK &symNumMse
//                    ╰──────────┴────────┴───────╯   ╰─────────┴─────────┴──────────╯
                        >;
                };
        };
};